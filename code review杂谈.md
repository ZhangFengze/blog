> *TDD和code reivew，总是让我联想到读书和健身。每个人都知道这是好的，但是又很难坚持下来*


### **code review和工具、流程无关**

我开始code review时，查了好久的资料，研究怎么把review流程集成进项目的工作流里。
例如每次提交前强制触发review，或者每次提交后自动通知review。  

后来我意识到，工具和流程不重要，重要的是沟通以及坚持。

所以code review可以只是找个合适的时间和同事坐在一起看代码。没有那么复杂。  


### **code review不是互相攻击**

我经历过几次推行code review的尝试，但是效果并不好。  

作为亲历者，每次项目自上而下推进code review时，我总是感到很紧张，生怕被别人发现自己的错误。当被review模块的负责人进入自我保护模式后，双方就变成了敌对关系。当情绪开始占上风，少有人能够保持理性。  

所以当我开始review时，我特别注意避免让code review变成互相攻击。我会传达我的期望，让现状变得更好，并且强调双方的目的是一致的。整个过程中态度要好，让对方放下戒心。对被review者来说，感到不自在、有戒心等，都是正常的。review者需要一以贯之的保持端正态度，久而久之双方关系自然会顺畅起来。如果review者自身态度不正，把review搞得像批斗会，那么效果差是必然的。  


### **code review应该求同存异**

我曾经坚定的认为，一个项目的代码风格应该是统一的，并且绝不理解为什么有些人能够容忍项目里有多种代码风格。后来有次看到了云风的一篇[博客](!https://blog.codingnow.com/2019/06/camelcase_underscore.html)，让我有了些新的思考。

认为一个项目的代码必须保持一致，是一个有代码洁癖的人的常见想法。洁癖者不能容忍不讲究的代码，也通常因此其代码质量更高。这是一个手艺人的自我修养。不过如果理性的分析，我们理应区分目标和手段。统一代码风格有收益也有成本。如果它的收益和目标没有太大关系，成本又太高，那么放着也无妨。  

期待所有人保持一致、以及期待所有人和自己保持一致，是code review乃至人生的常见问题。假如将所有问题分成两类，一类纯客观、一类纯主观。对于纯客观问题，理应所有人保持一致。对于纯主观问题，不可能所有人保持一致，并且也不应该朝着所有人一致的方向努力。尊重他人、尊重差异应该是人的基本修养。  

更常见的是主客观结合的问题。例如某段代码要不要时间换空间或者空间换时间。这类问题其实可以更细分下。首先确保所有人对纯客观部分认知一致，例如某个时间换空间的调整能够省掉50M内存占用，但增加10ms响应时间。然后确保做出主观决定的认知模型一致，例如大家都认同过早优化是不好的、优化应该先定位热点并按照80/20法则优化。最后留下的部分，一般是信息不对称，或者主观偏好不一致。


### **code review的收益应该是可积累的**

code review能减少偶然失误和弥补能力不足。  

偶然失误可以通过调整工作方式和习惯来减少，但是不可能彻底消除。code review能够将失误的概率，由一人失误，变成多人同时失误。但要想获得此好处，必须坚持code review。所以说，通过code review来减少偶然失误，是一分耕耘一分收获。  

能够一分耕耘一分收获已经足够好，因为面对复杂系统，更多的情况是我们把某一方面变好了，另一方面却变差了。能够有一个确实可用的方法提高项目质量，已经是万幸。但是这也代表着其收益不可积累，无法达到质变。  

还可以通过review弥补能力不足。常见的情况是，团队骨干去review其他人，因为骨干能力强，所以发现了很多问题，被review者修改后，整个模块质量上去了，但是被review者自身没有提高。这样的review也相当于是不可积累的。团队骨干再厉害，也至多长期review几个人的代码。  

所幸人是会成长的。如果每次code review都能让人成长一分，那么code review的结果就是可积累的。当团队能力整体提高了，哪怕不再code review，能力也不会再降低回去。  
